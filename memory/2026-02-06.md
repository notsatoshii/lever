# 2026-02-06 Memory Log

## Technical Decisions

### Pricing Feed Architecture
**From Eric:** Position/market systems must receive **smoothed prices**, not direct/raw pricing.

**Reason:** Exploit prevention — raw spot prices are vulnerable to:
- Flash loan manipulation
- Sandwich attacks
- Short-term price spikes/crashes

**Action:** Document this as a core requirement in oracle/pricing specifications.

## Frontend Fixes

### LP Page Data Display (Fixed)
**Issue:** FE showed incorrect APY calculation and unclear fee displays.

**Changes made to `frontend/src/app/lp/page.tsx` and `frontend/src/components/LPPanel.tsx`:**

1. **APY Calculation** - Fixed from wrong formula to proper calculation:
   - Base borrow rate: 0.02% per hour (from BorrowFeeEngineV2.BASE_RATE)
   - Annualized rate: 175.2% (0.0002 × 24 × 365)
   - LP APY = borrow_rate_annualized × utilization + trading_fee_contribution
   - Now scales properly with utilization

2. **Display improvements:**
   - Shows borrow fee APY breakdown
   - Shows trading fee APY breakdown
   - Shows share price gain if any
   - Added utilization context message

**Current Pool State (verified via contract):**
- TVL: ~$1,000,019 USDT
- Capital Deployed: ~$18,181 USDT
- Utilization: ~1.82%
- Share Price: 1.000019 (slight gain from fees)

Build verified successful.

### APY Update (per Eric's feedback)
**Issue:** APY only showed borrow fees, missing other fee sources.

**Updated to include ALL fee sources:**
1. **Borrow fees** - continuous accrual from open positions (0.02%/hr base)
2. **Trading fees** - on position open/close (~5 bps)
3. **Liquidation fees** - from liquidation penalties (~5%)

Formula now: `APY = (borrow_rate + trading_estimate + liquidation_estimate) × utilization`

Also shows actual share price gain when available (captures all fees accurately).

### Reference: Smoothing/PI Documentation
Eric noted that smoothing engine and probability index details are in vault docs **Modules 3, 4, 5**.
