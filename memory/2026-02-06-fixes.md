# 2026-02-06 Implementation Log

## Changes Requested & Planned

### 1. ✅ Fix Router vAMM Pointer (URGENT)
- **Issue:** Router points to old vAMM (0x31E5...) with skewed pools
- **Fix:** Update to fixed vAMM (0xab01...)
- **Tx:** 0xfe63a86a5f631a84e41ac9b853ee401cd524469c4526cf3e18fed560d303e03d
- **Status:** COMPLETE

### 2. ✅ RouterV5 with LP Integration
- **Issues Fixed:**
  - Router now calls `lpPool.allocate()` on position open
  - Router now calls `lpPool.deallocate()` on position close
  - Router now calls `lpPool.addFees()` when collecting fees
- **Deployed:** `0x90f2e2dad537f8f8eaa9d659538b26cb4bb5eea0`
- **Deploy Tx:** `0x47de1948e12ecad18f3c1351f6c5106769e473dbcdddd53fe02ae4b9071afb73`
- **Status:** COMPLETE

### 3. Smoothing Engine & Probability Index (PI) for Mark Price
- **Issue:** Verify smoothed PI is being used correctly
- **Finding:** PriceEngineV2 IS working with smoothing active
- **Router already uses:** `priceEngine.getMarkPrice()` for margin/PnL/liquidation
- **Status:** VERIFIED WORKING ✅

### 4. Frontend Fixes (COMPLETED)
- ✅ APY calculation includes all fees (borrow, trading, liquidations)
- ✅ Capital deployed shows actual OI from Ledger
- ✅ Utilization calculated from real OI

---

## Implementation Order

1. Fix Router vAMM (unblocks position closes)
2. Read Modules 3, 4, 5 for smoothing/PI spec
3. Implement RouterV5 with:
   - LP allocate/deallocate
   - Fee routing to LP pool
   - Proper smoothed price integration
4. Deploy and configure RouterV5
5. Update frontend contract addresses
